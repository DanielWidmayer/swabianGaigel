<div class="container p-4">
    <div class="container text-center p-3">
        <img src="/images/headLogo.png" height="180" class="img">
    </div>
    <div class="row">
        <div class="col-8">
            <%- include ../list/roomtable.ejs %>
        </div>
        <div class="col-4">
            <% include ../list/user.ejs %>
                <div class="card card-transparent mt-3 p-3">
                    <a type="button" class="btn btn-primary m-2" href="/create">Create new Room</a>
                </div>
        </div>
    </div>
</div>

<%- include ../list/modal_change_username.ejs %>

    <script>
        const rl = $("#roomlist").children("tbody"); var rooms = []; function getAllRooms() {
            rooms = []; $.get("/room",
                function (data, status) {
                    data.forEach((room) => {
                        rooms.push(room);
                        renderRoom(room);
                    });
                });
        }


        function renderRoom(room) {
            let target = $(`#${room.hashID}`);
            let players = room.players ? room.players.length : 0;
            console.log(players);
            if (target.length) {
                target.children(".rpl").html(`${players}/${room.maxplayers}`);
            } else {
                rl.append(`
                    <tr id="${room.hashID}"" onclick=" window.location.href='/join/${room.hashID
                    }' ;">
                        <td class="rname">${room.name}</td>
                        <td class="rpw">${room.password ? "yes" : "no"}</td>
                        <td class="rpl">${players}/${room.maxplayers}</td>
                    </tr>`);
            }
        }

        window.onload = function () {
            getAllRooms();
        };

        io.socket.on("listevent", function (data) {
            console.log(data);
            renderRoom(data.room);
        });

    </script>